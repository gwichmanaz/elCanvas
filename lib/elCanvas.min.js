function elCanvas(container,props){var el=this;this._chain_ctx=function(obj){var _this=this;this.passthrough=["createImageData","createLinearGradient","createPattern","createRadialGradient","getImageData","getLineDash","isPointInPath","isPointInStroke","measureText"];this.obj=obj;var _loop=function(method){if(typeof obj[method]==="function"){_this[method]=function(){_this.obj[method].apply(_this.obj,arguments);if(_this.passthrough.indexOf(method)>-1){return _this.obj[method].apply(_this.obj,arguments)}else{return _this}}}};for(var method in obj){_loop(method)}_this.set=function(prop,val){this.obj[prop]=val;return this}};if(!props){props={images:{}}}if(!props.images){props.images={}}this.ctx=new this._chain_ctx(container.getContext("2d"));this.ctx.canvas=container;this.width=props.width?props.width:container.offsetWidth;this.height=props.height?props.height:container.offsetHeight;this.center={x:this.width/2,y:this.height/2};this.images=props?props.images:{};this.AlignToCenter=props?props.AlignToCenter:false;this.container=container;this.objects=[];this.objectsCount=0;this.interactableObjects=[];this.interactableObjectCount=0;this.firstFrame=true;this.customShapes={};this._util={};this.objectTypes=["rect","circle","line","quadLine","image","shape","text","svg"];this.defaultStyles={fallback:{lineWidth:.001,fillStyle:"#"+Math.floor(Math.random()*16777215).toString(16),strokeStyle:"#ffffff"},rect:{fillStyle:"#"+Math.floor(Math.random()*16777215).toString(16)},svg:{fillStyle:"#"+Math.floor(Math.random()*16777215).toString(16)},text:{fillStyle:"#"+Math.floor(Math.random()*16777215).toString(16),font:"30px museo300",fillStyle:"#ff0000",textAlign:"center"},line:{strokeStyle:"#ff0000",lineWidth:5,lineCap:"round"},quadLine:{strokeStyle:"#ff0000",lineWidth:5,lineCap:"round"},image:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA+CAMAAABeI7j4AAAAkFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADDIYgjAAAAL3RSTlMA+/kEUo+SouQeRw3FBvLhpjOfl3EWq3NMJNzCjIRa0bpOQy8rCep+ZmM5LtLMs4FqBYIAAAHLSURBVEjH5dTbcoIwEIDh3YRa1FKqFOr5rLXadt//7bqs6KqDSfS2/zgchG8Ckyg80LrpLQew56QVx2nsiq++X5qIAqqMEvRkTkYJf8zNiEiNEl9qlMTDl/qGP+bCKMmgXR+sYsKD+SiNkhHcKk/5uholDbC1JdCXUdScyBPUZ6EpRI2f6ChqgkZRsw0hKRmU2CAVIQ/2Suc9+wiXj966ZdkMCYOItjBk7iIWWveSxEWsBc2GjFIDfARWHb0tX4hzEJmHQdzhnRwnBX2JcRFYfRMNxCSQvBEZNm6ynJIxYipBZusmybD8WowI5GPcgXUQmLweTLoHEXwpa3veZS4GaToTIVesm0CvMufCSawY5O+QVNwgauab6neowrtgouODdcvZCSFJRhLSdAngJ/YwH9W7pB3vg6kgUuMZZX0URjal8ZC2CL40jja8E+MmtiBkIedRtXbivXuNjfismkFZB3zy0ncT+NQZPKy3Ye5eY1bMiA+Oa2eWB6yxcUN2spkUzZA1JhvNv8b0Ls1Pwv/66vsPBB8hDbCJdbWG3hUZg7fd1bv8tiJPi/EVwYDkRiXBKUFzFpq65FmOxGBwQiZ0VwWTZda4o2wCj/QHW46eA37RLLEAAAAASUVORK5CYII=",object:{}}};this.defaultProps={fallback:{globalCompositeOperation:"source-over",transformOrigin:"50% 50%",x:0,y:0,skewX:0,skewY:0,xOffset:el.AlignToCenter?el.center.x:0,yOffset:el.AlignToCenter?el.center.y:0,scaleX:1,scaleY:1,scale:1,opacity:1,rotation:0,zIndex:0,parent:{id:"dummyParent"}},circle:{radius:50},line:{x1:0,y1:0,x2:100,y2:100},quadLine:{x1:0,y1:0,qx:0,qy:50,x2:100,y2:100},rect:{width:100,height:100},svg:{__cachedPoints:"",__cachedFunction:function(){},width:100,height:100,points:"93.8,11.7 82.1,0 46.9,35.2 11.7,0 0,11.7 35.2,46.9 0,82.1 11.7,93.8 46.9,58.6 82.1,93.8 93.8,82.1 58.6,46.9"},image:{rounded:false},text:{width:0,height:0},textSprite:{letterSpacing:0,lineHeight:1,size:1,x:0,y:0,width:container.width,height:container.height,rounded:false,align:"left"}};this.constructor=function(){el.objectTypes.forEach(function(item){el.defaultProps[item]=el.defaultProps[item]?el.defaultProps[item]:el.defaultProps.fallback;el.defaultStyles[item]=el.defaultStyles[item]?el.defaultStyles[item]:el.defaultStyles.fallback;el[item]=function(suppliedProps,arrayPosition){if(!suppliedProps){suppliedProps={}}suppliedProps.style=Object.assign({},suppliedProps.style);props=el._util.init_check_props_push(Object.assign({},suppliedProps),item);return props}})}();this.styleShape=function(shape_styles,type){Object.keys(shape_styles).forEach(function(key){el.ctx.set(key,shape_styles[key])})};this.recursiveLoop_checkForParent=function(props){var parentExists=props.parent.id!="dummyParent";if(parentExists){el.recursiveLoop_checkForParent(props.parent);el.translateScaleRotate(props.parent)}};this.translateScaleRotate=function(props,parentLevel){if(props.type=="circle"){props.width=props.height=props.radius/2}var tO=props.transformOrigin.replace(/%/g,"").split(" ");props.centerX=props.width*(Number(tO[0])/100);props.centerY=props.height*(Number(tO[1])/100);if(!props.width&&!props.height){props.width=props.height=0}var matrix=new el._util.matrix(0,0);matrix.translate(el.defaultProps.fallback.xOffset,el.defaultProps.fallback.yOffset);matrix.translate(props.x,props.y);matrix.translate(props.centerX,props.centerY);matrix.skew(props.skewX,props.skewY);matrix.rotate(props.rotation*Math.PI/180);matrix.scale(props.scaleX,props.scaleY);matrix.translate(-props.centerX,-props.centerY);el.ctx.transform(matrix.data[0],matrix.data[1],matrix.data[2],matrix.data[3],matrix.data[4],matrix.data[5])};this.drawShape=function(props){el.ctx.save();el.ctx.set("globalCompositeOperation",props.globalCompositeOperation);el.recursiveLoop_checkForParent(props);el.translateScaleRotate(props)};this.fillAndStroke=function(style,opacity){el.ctx.set("globalAlpha",opacity);if(style.fillStyle){el.ctx.fill()}if(style.strokeStyle){el.ctx.stroke()}};this.shapes={rect:function(p){el.drawShape(p);if(p.radius){el._util.shapes.roundRect(0,0,p.width,p.height,p.radius)}else{el._util.shapes.normalRect(0,0,p.width,p.height)}if(!p.null){el.fillAndStroke(p.style,p.opacity)}},circle:function(p){el.drawShape(p);el._util.shapes.circle(0,0,p.radius);el.fillAndStroke(p.style,p.opacity)},line:function(p){p.x=p.x1;p.y=p.y1;el.drawShape(p);el.ctx.beginPath().moveTo(0,0).lineTo(p.x2-p.x1,p.y2-p.y1);el.fillAndStroke(p.style,p.opacity)},quadLine:function(p){p.x=p.x1;p.y=p.y1;el.drawShape(p);el.ctx.beginPath().moveTo(0,0).quadraticCurveTo(p.qx,p.qy,p.x2-p.x1,p.y2-p.y1);el.fillAndStroke(p.style,p.opacity)},image:function(p){var image=el.images[p.id]||el.defaultStyles.image.object;p.width=p.width?p.width:image.width;p.height=p.height?p.height:image.height;if(p.textProps){p.width=p.textProps.w;p.height=p.textProps.h}el.drawShape(p);el.fillAndStroke("empty",p.opacity);if(p.textProps){el.ctx.drawImage(image,p.textProps.x,p.textProps.y,p.textProps.w,p.textProps.h,0,0,p.textProps.w*p.textProps.scale,p.textProps.h*p.textProps.scale)}else{if(p.rounded){el._util.shapes.roundRect(0,0,p.width,p.height,p.rounded);el.ctx.clip()}el.ctx.drawImage(image,0,0,p.width,p.height)}el.fillAndStroke(p.style,"empty")},text:function(p){el.drawShape(p);el.fillAndStroke("empty",p.opacity);if(p.maxWidth){var textWidth=el.ctx.measureText(p.text).width;if(p.maxWidth<textWidth){var yScale=p.maxWidth/textWidth;el.ctx.scale(1,yScale)}if(p.style.strokeStyle){el.ctx.strokeText(p.text,0,0,p.maxWidth)}el.ctx.fillText(p.text,0,0,p.maxWidth)}else{if(p.style.strokeStyle){el.ctx.strokeText(p.text,0,0)}el.ctx.fillText(p.text,0,0)}},shape:function(p){el.drawShape(p);if(typeof p.customShape==="function"){p.customShape(this)}else if(el.customShapes[p.customShape]){el.customShapes[p.customShape]()}el.fillAndStroke(p.style,p.opacity)},svg:function(p){el.drawShape(p);if(p.__cachedPoints!==p.points){p.__cachedFunction=el._util.parseSvgPathData(p.points,el.ctx);p.__cachedPoints=p.points}p.__cachedFunction();el.fillAndStroke(p.style,p.opacity)}};this.spriteFonts=props.spriteFonts?props.spriteFonts:[];var spriteFonts_rearanged=[];for(var i=0;i<this.spriteFonts.length;i++){var font=this.spriteFonts[i];var newFont=this.spriteFonts[i].meta.image;var newFontDictionary=this.spriteFonts[i].frames;spriteFonts_rearanged[newFont]=newFontDictionary}this.spriteFonts=spriteFonts_rearanged;this.textSprite=function(props){this.breakLine=function(){positionData.x=0;positionData.y+=dynamicInfo.h*props.lineHeight*props.scale};if(!el.spriteFonts[props.font]){console.error("please run el.addSpriteFont(fontID, dictionary for for font) before using a sprite font")}var splitSentence=props.text.split("");var spriteContainer=new el.rect({x:props.x,y:props.y,null:true});var positionData={x:0,y:0,scale:props.scale};for(var key in el.defaultProps.textSprite){if(!props[key]){props[key]=el.defaultProps.textSprite[key]}}var individualSprites=[];for(var y=0;y<splitSentence.length;y++){var letter=splitSentence[y];if(letter=="^"){this.breakLine()}var dictionaryData=el.spriteFonts[props.font][letter];if(dictionaryData){var dynamicInfo=Object.assign({},dictionaryData.frame);dictionaryData.frael.letter=letter;dynamicInfo.scale=props.scale;if(positionData.x>props.x+props.width){this.breakLine()}individualSprites[y]=new el.image({parent:spriteContainer,x:positionData.x,y:positionData.y,id:props.font,textProps:dynamicInfo});positionData.x+=(dynamicInfo.w+props.letterSpacing)*props.scale}}spriteContainer.letters=individualSprites;return spriteContainer};this.update=function(){if(el.firstFrame){el._util.addParents(el.objects);el.objects.sort(function(a,b){return(b.zIndex-a.zIndex)*-1})}el.ctx.clearRect(0,0,9999,9999);for(var update_i=0;update_i<el.objectsCount;update_i++){var activeObject=el.objects[update_i];el._util.setObjectScale(activeObject);el.styleShape(el.objects[update_i].style,el.objects[update_i].type);el.shapes[activeObject.type](activeObject);if(activeObject.debug){el._util.shapes.circle(activeObject.centerX,activeObject.centerY,10);el.ctx.set("globalCompositeOperation","difference");el.ctx.fill()}el.ctx.restore()}el.firstFrame=false};this.resetZIndex=function(){el.objects.sort(function(a,b){return(b.zIndex-a.zIndex)*-1})};this.remove=function(obj){var objectIndex=this.objects.indexOf(obj);if(obj instanceof Array){for(var i=0;i<obj.length;i++){this.remove(obj[i])}}else if(objectIndex<0){console.warn("EL: Object you're trying to remove is not in elCanvas")}else{if(obj.childNodes){for(var i=0;i<obj.childNodes.length;i++){var childObject=obj.childNodes[i];var childIndex=this.objects.indexOf(childObject);this.objects.splice(childIndex,1);this.objectsCount--}}this.objects.splice(objectIndex,1);this.objectsCount--}};this._util={matrix:function(){this.data=[1,0,0,1,0,0];this.translate=function(x,y){this.data[4]+=this.data[0]*x+this.data[2]*y;this.data[5]+=this.data[1]*x+this.data[3]*y};this.scale=function(x,y){this.data[0]*=x;this.data[1]*=x;this.data[2]*=y;this.data[3]*=y};this.rotate=function(radians){var cos=Math.cos(radians);var sin=Math.sin(radians);var m11=this.data[0]*cos+this.data[2]*sin;var m12=this.data[1]*cos+this.data[3]*sin;var m21=-this.data[0]*sin+this.data[2]*cos;var m22=-this.data[1]*sin+this.data[3]*cos;this.data[0]=m11;this.data[1]=m12;this.data[2]=m21;this.data[3]=m22};this.skew=function(degX,degY){var tanX=Math.tan(degX*Math.PI/180);var tanY=Math.tan(degY*Math.PI/180);var matrix0=this.data[0];var matrix1=this.data[1];this.data[0]+=tanY*this.data[2];this.data[1]+=tanY*this.data[3];this.data[2]+=tanX*matrix0;this.data[3]+=tanX*matrix1};return this},shapes:{circle:function(x,y,r){return el.ctx.beginPath().arc(x,y,r,0,2*Math.PI,false).closePath()},normalRect:function(x,y,w,h){return el.ctx.beginPath().rect(x,y,w,h).closePath()},roundRect:function(x,y,w,h,r){var cornerRadius={tl:r,tr:r,bl:r,br:r};if(typeof r=="object"){cornerRadius=r}return el.ctx.beginPath().moveTo(x+cornerRadius.tl,y).lineTo(x+w-cornerRadius.tr,y).quadraticCurveTo(x+w,y,x+w,y+cornerRadius.tr).lineTo(x+w,y+h-cornerRadius.br).quadraticCurveTo(x+w,y+h,x+w-cornerRadius.br,y+h).lineTo(x+cornerRadius.bl,y+h).quadraticCurveTo(x,y+h,x,y+h-cornerRadius.bl).lineTo(x,y+cornerRadius.tl).quadraticCurveTo(x,y,x+cornerRadius.tl,y).closePath()}},init_check_props_push:function(props,type,count){if(!props){props={}}if(!props.style){props.style={}}props.type=type;el._util.replaceIfDoesntExist(props,el.defaultProps.fallback);el._util.replaceIfDoesntExist(props,el.defaultProps[type]);el._util.replaceIfDoesntExist(props.style,el.defaultStyles[type]);if(type=="text"){if(props.style["textBaseline"]=="safari"){delete props.style["textBaseline"]}}if(type=="image"){if(!el.images[props.id]){var img=new Image;img.src=el.defaultStyles.image.src;img.id="backup";el.defaultStyles.image.object=img}}el.objects.push(props);if(props.interactable){el.interactableObjects.push(props)}el.interactableObjectCount=el.interactableObjects.length;el.objectsCount=el.objects.length;return props},replaceIfDoesntExist:function(providedObject,newObject){Object.keys(newObject).forEach(function(key,value){if(!providedObject[key]&&providedObject[key]!==0){providedObject[key]=newObject[key]}})},setObjectScale:function(props){if(props.scale!=1){props.scaleX=props.scale;props.scaleY=props.scale}},shuffleArray:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}},addParents:function(objects){for(var i=0;i<objects.length;i++){if(objects[i].parent.id!="dummyParent"){objects[i].zIndex+=objects[i].parent.zIndex;if(!objects[i].parent.childNodes){objects[i].parent.childNodes=[]}objects[i].parent.childNodes.push(objects[i])}}},generateRadialGradientBitmap:function(id,size,innerColour,outerColour){var buffer=document.createElement("canvas"),width=size<<1;buffer.width=buffer.height=width;var ctx=buffer.getContext("2d"),radgrad=ctx.createRadialGradient(size,size,size>>1,size,size,size);radgrad.addColorStop(0,innerColour);radgrad.addColorStop(1,outerColour);ctx.fillStyle=radgrad;ctx.fillRect(0,0,width,width);var img=new Image;img.src=buffer.toDataURL("image/png");el.images[id]=img},hitTestMath:function(rect1,rect2){return rect1.x<rect2.x+rect2.width&&rect1.x+rect1.width>rect2.x&&rect1.y<rect2.y+rect2.height&&rect1.y+rect1.height>rect2.y?true:false},debounce:function(fn){var timeout;return function(){var context=this;var args=arguments;if(timeout){window.cancelAnimationFrame(timeout)}timeout=window.requestAnimationFrame(function(){fn.apply(context,args)})}},parseSvgPathData:function(data,ctx){var calls=[];var ifc={init:function(){this.x=this.x0=this.x1=this.x2=this.y=this.y0=this.y1=this.y2=0;calls.push([el.ctx.beginPath,[]])},A:function(rx,ry,rot,fA,fS,x,y){var x12=x-this.x,y12=y-this.y,phi=rot/180*Math.PI,cp=phi?Math.cos(phi):1,sp=phi?Math.sin(phi):0,k=ry/rx,dth_sgn=fS?1:-1,Nx=dth_sgn*(-x12*cp-y12*sp),Ny=dth_sgn*(-x12*sp+y12*cp),NN=Math.hypot(Nx,Ny/k),R=2*rx>NN?rx:NN/2,dth=2*dth_sgn*Math.asin(NN/2/R),th1,ct,st;if(fA)dth=dth>0?2*Math.PI-dth:-2*Math.PI-dth;th1=Math.atan2(k*Nx,Ny)-dth/2,ct=Math.cos(th1);st=Math.sin(th1);calls.push([el.ctx.ellipse,[this.x-R*(cp*ct-sp*k*st),this.y-R*(sp*ct+cp*k*st),R,R*k,phi,th1,th1+dth,dth_sgn===-1]]);this.x=x;this.y=y},M:function(x,y){calls.push([el.ctx.moveTo,[this.x=this.x0=x,this.y=this.y0=y]])},L:function(x,y){calls.push([el.ctx.lineTo,[this.x=x,this.y=y]])},H:function(x){calls.push([el.ctx.lineTo,[this.x=x,this.y]])},V:function(y){calls.push([el.ctx.lineTo,[this.x,this.y=y]])},C:function(x1,y1,x2,y2,x,y){calls.push([el.ctx.bezierCurveTo,[this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2,this.x=x,this.y=y]])},S:function(x2,y2,x,y){calls.push([el.ctx.bezierCurveTo,[this.x1=2*this.x-this.x2,this.y1=2*this.y-this.y2,this.x2=x2,this.y2=y2,this.x=x,this.y=y]])},Q:function(x1,y1,x,y){calls.push([el.ctx.quadraticCurveTo,[this.x1=x1,this.y1=y1,this.x=x,this.y=y]])},T:function(x,y){calls.quadraticCurveTo([el.ctx.quadraticCurveTo,[this.x1+=2*(this.x-this.x1),this.y1+=2*(this.y-this.y1),this.x=x,this.y=y]])},Z:function(){calls.push([el.ctx.closePath,[]])},a:function(rx,ry,rot,fA,fS,x,y){this.A(rx,ry,rot,fA,fS,this.x+x,this.y+y)},m:function(x,y){this.M(this.x+x,this.y+y)},l:function(x,y){this.L(this.x+x,this.y+y)},h:function(x){this.H(this.x+x)},v:function(y){this.V(this.y+y)},c:function(x1,y1,x2,y2,x,y){this.C(this.x+x1,this.y+y1,this.x+x2,this.y+y2,this.x+x,this.y+y)},s:function(x2,y2,x,y){this.S(this.x+x2,this.y+y2,this.x+x,this.y+y)},q:function(x1,y1,x,y){this.Q(this.x+x1,this.y+y1,this.x+x,this.y+y)},t:function(x,y){this.T(this.x+x,this.y+y)},z:function(){this.Z()},x0:0,y0:0,x:0,y:0,x1:0,y1:0,x2:0,y2:0};var rex=/([achlmqstvz])([^achlmqstvz]*)/gi;var seg={A:{n:7,f:"A"},C:{n:6,f:"C"},H:{n:1,f:"H"},L:{n:2,f:"L"},M:{n:2,f:"L"},Q:{n:4,f:"Q"},S:{n:4,f:"S"},T:{n:2,f:"T"},V:{n:1,f:"V"},Z:{n:0},a:{n:7,f:"a"},c:{n:6,f:"c"},h:{n:1,f:"h"},l:{n:2,f:"l"},m:{n:2,f:"l"},q:{n:4,f:"q"},s:{n:4,f:"s"},t:{n:2,f:"t"},v:{n:1,f:"v"},z:{n:0}};var segment=function(ifc,type,args){if(type in seg){if(args.length===seg[type].n){var _ifc;(_ifc=ifc)[type].apply(_ifc,args)}else if(args.length>seg[type].n){var _ifc2;(_ifc2=ifc)[type].apply(_ifc2,args);args.splice(0,seg[type].n);segment(ifc,seg[type].f,args)}}};var match;if(!ifc)ifc=parseSvgPathData.defaultIfc;ifc.init(el.ctx);while(match=rex.exec(data)){segment(ifc,match[1],match[2].replace(/^\s+|\s+$/g,"").replace(/(\d)\-/g,"$1 -").split(/[, \t\n\r]+/g).map(Number))}var drawSVGShape=function(){calls.forEach(function(a){a[0].apply(el.ctx,a[1])})};return drawSVGShape}};this.addEventListener=function(event,response){var target=this.container;this.container.addEventListener(event,function(e){e=e||window.event;var style=target.currentStyle||window.getComputedStyle(target,null),borderLeftWidth=parseInt(style["borderLeftWidth"],10),borderTopWidth=parseInt(style["borderTopWidth"],10),rect=target.getBoundingClientRect(),scaleX=rect.width/el.width,scaleY=rect.height/el.height,offsetX=(e.clientX-borderLeftWidth-rect.left)/scaleX,offsetY=(e.clientY-borderTopWidth-rect.top)/scaleY;e.canvasX=offsetX,e.canvasY=offsetY;response(e)})};this.hitTest=function(mousePosition,returnFunction){for(var i=0;i<el.interactableObjectCount;i++){var obj=el.interactableObjects[i];var hit=el._util.hitTestMath(mousePosition,obj);if(hit){returnFunction(obj);break}}};this.addResizeListener=function(callback){var resizeListen=this._util.debounce(callback);window.addEventListener("resize",function(){el.container.width=el.container.parentNode.offsetWidth;el.container.height=el.container.parentNode.offsetHeight;el.width=el.container.width;el.height=el.container.height;resizeListen("debounced")},false)}}function el_imageLoad(imageURL,completeFunction){if(imageURL.length==0){completeFunction([])}var imagesLoaded=0;var imageOBJ={};[].forEach.call(imageURL,function(imageURL,index){var img=new Image;img.src=imageURL.url;img.id=imageURL.id;img.addEventListener("load",imageLoad_check,false)});function imageLoad_check(){imageOBJ[this.id]=this;imagesLoaded++;if(imagesLoaded==imageURL.length){completeFunction(imageOBJ);return imageOBJ}}}