elCanvas=function(){var t,i={fallback:{lineWidth:.001,fillStyle:"#"+Math.floor(16777215*Math.random()).toString(16),strokeStyle:"#ffffff"},rect:{fillStyle:"#"+Math.floor(16777215*Math.random()).toString(16)},svg:{fillStyle:"#"+Math.floor(16777215*Math.random()).toString(16)},text:{fillStyle:"#"+Math.floor(16777215*Math.random()).toString(16),font:"30px museo300",fillStyle:"#ff0000",textAlign:"center"},line:{strokeStyle:"#ff0000",lineWidth:5,lineCap:"round"},quadLine:{strokeStyle:"#ff0000",lineWidth:5,lineCap:"round"},image:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA+CAMAAABeI7j4AAAAkFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADDIYgjAAAAL3RSTlMA+/kEUo+SouQeRw3FBvLhpjOfl3EWq3NMJNzCjIRa0bpOQy8rCep+ZmM5LtLMs4FqBYIAAAHLSURBVEjH5dTbcoIwEIDh3YRa1FKqFOr5rLXadt//7bqs6KqDSfS2/zgchG8Ckyg80LrpLQew56QVx2nsiq++X5qIAqqMEvRkTkYJf8zNiEiNEl9qlMTDl/qGP+bCKMmgXR+sYsKD+SiNkhHcKk/5uholDbC1JdCXUdScyBPUZ6EpRI2f6ChqgkZRsw0hKRmU2CAVIQ/2Suc9+wiXj966ZdkMCYOItjBk7iIWWveSxEWsBc2GjFIDfARWHb0tX4hzEJmHQdzhnRwnBX2JcRFYfRMNxCSQvBEZNm6ynJIxYipBZusmybD8WowI5GPcgXUQmLweTLoHEXwpa3veZS4GaToTIVesm0CvMufCSawY5O+QVNwgauab6neowrtgouODdcvZCSFJRhLSdAngJ/YwH9W7pB3vg6kgUuMZZX0URjal8ZC2CL40jja8E+MmtiBkIedRtXbivXuNjfismkFZB3zy0ncT+NQZPKy3Ye5eY1bMiA+Oa2eWB6yxcUN2spkUzZA1JhvNv8b0Ls1Pwv/66vsPBB8hDbCJdbWG3hUZg7fd1bv8tiJPi/EVwYDkRiXBKUFzFpq65FmOxGBwQiZ0VwWTZda4o2wCj/QHW46eA37RLLEAAAAASUVORK5CYII="}},e={fallback:{globalCompositeOperation:"source-over",transformOrigin:"50% 50%",x:0,y:0,skewX:0,skewY:0,xOffset:0,yOffset:0,scaleX:1,scaleY:1,scale:1,opacity:1,rotation:0,zIndex:0,parent:{id:"dummyParent"}},circle:{radius:50},line:{x1:0,y1:0,x2:100,y2:100},quadLine:{x1:0,y1:0,qx:0,qy:50,x2:100,y2:100},rect:{width:100,height:100},svg:{__cachedPoints:"",__cachedFunction:function(){},width:100,height:100,points:"93.8,11.7 82.1,0 46.9,35.2 11.7,0 0,11.7 35.2,46.9 0,82.1 11.7,93.8 46.9,58.6 82.1,93.8 93.8,82.1 58.6,46.9"},image:{rounded:!1},text:{width:0,height:0},shape:{customShape:function(t){}},textSprite:{transformOrigin:"0% 0%",letterSpacing:0,lineHeight:1,size:1,x:0,y:0,rounded:!1,align:"left",null:!0}};function n(){return t||((t=new Image).src=i.image.src,t.id="backup"),t}var a=["createImageData","createLinearGradient","createPattern","createRadialGradient","getImageData","getLineDash","isPointInPath","isPointInStroke","measureText"];function s(t){var i=this;function e(t){a.indexOf(t)>-1?i[t]=i.ctx[t].bind(i.ctx):i[t]=function(){return i.ctx[t].apply(i.ctx,arguments),i}}for(var n in i.ctx=t,t)"function"==typeof t[n]&&e(n)}function h(){this.data=[1,0,0,1,0,0]}s.prototype={set:function(t,i){return this.ctx[t]=i,this},setAll:function(t){for(var i in t)this.ctx[i]=t[i];return this},fillAndStroke:function(t,i){return this.set("globalAlpha",i),t.fillStyle&&this.fill(),t.strokeStyle&&this.stroke(),this}},h.prototype={translate:function(t,i){this.data[4]+=this.data[0]*t+this.data[2]*i,this.data[5]+=this.data[1]*t+this.data[3]*i},scale:function(t,i){this.data[0]*=t,this.data[1]*=t,this.data[2]*=i,this.data[3]*=i},rotate:function(t){var i=Math.cos(t),e=Math.sin(t),n=this.data[0]*i+this.data[2]*e,a=this.data[1]*i+this.data[3]*e,s=-this.data[0]*e+this.data[2]*i,h=-this.data[1]*e+this.data[3]*i;this.data[0]=n,this.data[1]=a,this.data[2]=s,this.data[3]=h},skew:function(t,i){var e=Math.tan(t*Math.PI/180),n=Math.tan(i*Math.PI/180),a=this.data[0],s=this.data[1];this.data[0]+=n*this.data[2],this.data[1]+=n*this.data[3],this.data[2]+=e*a,this.data[3]+=e*s}};var r={shapes:{circle:function(t,i,e,n){return t.ctx.beginPath().arc(i,e,n,0,2*Math.PI,!1).closePath()},normalRect:function(t,i,e,n,a){return t.ctx.beginPath().rect(i,e,n,a).closePath()},roundRect:function(t,i,e,n,a,s){var h="object"==typeof s?s:{tl:s,tr:s,bl:s,br:s};return t.ctx.beginPath().moveTo(i+h.tl,e).lineTo(i+n-h.tr,e).quadraticCurveTo(i+n,e,i+n,e+h.tr).lineTo(i+n,e+a-h.br).quadraticCurveTo(i+n,e+a,i+n-h.br,e+a).lineTo(i+h.bl,e+a).quadraticCurveTo(i,e+a,i,e+a-h.bl).lineTo(i,e+h.tl).quadraticCurveTo(i,e,i+h.tl,e).closePath()}},missingLetterProps:function(t){var i;return{type:"rect",width:(i=(i=t[" "]?t[" "].frame:t[Object.keys(t)[0]])||{w:1,h:1}).w,height:i.h,style:{lineWidth:2,strokeStyle:"#000000",fillStyle:!1}}},adjustAlignment:function(t,i,e){function n(n,a){var s=i-(t[a].x+t[a].width);"center"==e&&(s/=2);for(var h=n;h<=a;h++)t[h].x+=s}if("left"!=e){for(var a=0,s=1;s<t.length;)t[s].y>t[a].y&&(n(a,s-1),a=s),s++;n(a,s-1)}},mergeDefaultProperties:function(t,n){return(t=t||{}).style=t.style||{},t.type=n,r.setIfUndefined(t,e[n]),r.setIfUndefined(t,e.fallback),r.setIfUndefined(t.style,i[n]||i.fallback),t},setIfUndefined:function(t,i){var e=Object.assign({},i,t);Object.assign(t,e)},setObjectScale:function(t){1!=t.scale&&(t.scaleX=t.scale,t.scaleY=t.scale)},shuffleArray:function(t){for(var i=t.length-1;i>0;i--){var e=Math.floor(Math.random()*(i+1)),n=t[i];t[i]=t[e],t[e]=n}},objectsCount:0,objects:0,addParents:function(t){t.forEach(function(t){t.parent&&"dummyParent"!=t.parent.id&&(t.zIndex+=t.parent.zIndex,t.parent.childNodes||(t.parent.childNodes=[]),t.parent.childNodes.push(t))})},loadImageFromUrl:function(t,i,e){t[i]=new Promise(function(n,a){var s=new Image;s.src=e,s.id=i,s.addEventListener("load",function(){t[i]=s,n(s)},!1)})},generateRadialGradientBitmap:function(t,i,e,n){var a=document.createElement("canvas"),s=i<<1;a.width=a.height=s;var h=a.getContext("2d"),r=h.createRadialGradient(i,i,i>>1,i,i,i);r.addColorStop(0,e),r.addColorStop(1,n),h.fillStyle=r,h.fillRect(0,0,s,s);var o=new Image;return o.src=a.toDataURL("image/png"),o},fullyInside:function(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y},debounce:function(t){var i;return function(){var e=this,n=arguments;i&&window.cancelAnimationFrame(i),i=window.requestAnimationFrame(function(){t.apply(e,n)})}},parseSvgPathData:function(t,i){var e,n=t.points,a={x:[],y:[]},s=[],h={init:function(){this.x=this.x0=this.x1=this.x2=this.y=this.y0=this.y1=this.y2=0,s.push([i.beginPath,[]])},A:function(t,e,n,h,r,o,c){var l,d,u,f=o-this.x,A=c-this.y,p=n/180*Math.PI,y=p?Math.cos(p):1,g=p?Math.sin(p):0,x=e/t,m=r?1:-1,v=m*(-f*y-A*g),b=m*(-f*g+A*y),w=Math.hypot(v,b/x),S=2*t>w?t:w/2,I=2*m*Math.asin(w/2/S);h&&(I=I>0?2*Math.PI-I:-2*Math.PI-I),l=Math.atan2(x*v,b)-I/2,d=Math.cos(l),u=Math.sin(l),s.push([i.ellipse,[this.x-S*(y*d-g*x*u),this.y-S*(g*d+y*x*u),S,S*x,p,l,l+I,-1===m]]),this.x=o,this.y=c,a.x.push(o),a.y.push(c)},M:function(t,e){a.x.push(t),a.y.push(e),s.push([i.moveTo,[this.x=this.x0=t,this.y=this.y0=e]])},L:function(t,e){a.x.push(t),a.y.push(e),s.push([i.lineTo,[this.x=t,this.y=e]])},H:function(t){a.x.push(t),s.push([i.lineTo,[this.x=t,this.y]])},V:function(t){a.y.push(t),s.push([i.lineTo,[this.x,this.y=t]])},C:function(t,e,n,h,r,o){a.x.push(r),a.y.push(o),s.push([i.bezierCurveTo,[this.x1=t,this.y1=e,this.x2=n,this.y2=h,this.x=r,this.y=o]])},S:function(t,e,n,h){a.x.push(n),a.y.push(h),s.push([i.bezierCurveTo,[this.x1=2*this.x-this.x2,this.y1=2*this.y-this.y2,this.x2=t,this.y2=e,this.x=n,this.y=h]])},Q:function(t,e,n,h){a.x.push(n),a.y.push(h),s.push([i.quadraticCurveTo,[this.x1=t,this.y1=e,this.x=n,this.y=h]])},T:function(t,e){a.x.push(t),a.y.push(e),s.quadraticCurveTo([i.quadraticCurveTo,[this.x1+=2*(this.x-this.x1),this.y1+=2*(this.y-this.y1),this.x=t,this.y=e]])},Z:function(){s.push([i.closePath,[]])},a:function(t,i,e,n,a,s,h){this.A(t,i,e,n,a,this.x+s,this.y+h)},m:function(t,i){this.M(this.x+t,this.y+i)},l:function(t,i){this.L(this.x+t,this.y+i)},h:function(t){this.H(this.x+t)},v:function(t){this.V(this.y+t)},c:function(t,i,e,n,a,s){this.C(this.x+t,this.y+i,this.x+e,this.y+n,this.x+a,this.y+s)},s:function(t,i,e,n){this.S(this.x+t,this.y+i,this.x+e,this.y+n)},q:function(t,i,e,n){this.Q(this.x+t,this.y+i,this.x+e,this.y+n)},t:function(t,i){this.T(this.x+t,this.y+i)},z:function(){this.Z()},x0:0,y0:0,x:0,y:0,x1:0,y1:0,x2:0,y2:0},r=/([achlmqstvz])([^achlmqstvz]*)/gi,o={A:{n:7,f:"A"},C:{n:6,f:"C"},H:{n:1,f:"H"},L:{n:2,f:"L"},M:{n:2,f:"L"},Q:{n:4,f:"Q"},S:{n:4,f:"S"},T:{n:2,f:"T"},V:{n:1,f:"V"},Z:{n:0},a:{n:7,f:"a"},c:{n:6,f:"c"},h:{n:1,f:"h"},l:{n:2,f:"l"},m:{n:2,f:"l"},q:{n:4,f:"q"},s:{n:4,f:"s"},t:{n:2,f:"t"},v:{n:1,f:"v"},z:{n:0}},c=function(t,i,e){if(i in o)if(e.length===o[i].n){var n=t;n[i].apply(n,e)}else if(e.length>o[i].n){var a=t;a[i].apply(a,e),e.splice(0,o[i].n),c(t,o[i].f,e)}};for(h.init();e=r.exec(n);)c(h,e[1],e[2].replace(/^\s+|\s+$/g,"").replace(/(\d)\-/g,"$1 -").split(/[, \t\n\r]+/g).map(Number));var l=Math.min.apply(null,a.x),d=Math.max.apply(null,a.x),u=Math.min.apply(null,a.y),f=Math.max.apply(null,a.y);t.width=2*(l+(d-l)/2),t.height=2*(u+(f-u)/2);return function(){s.forEach(function(t){t[0].apply(i,t[1])})}},hitTest:function(t,i,e){for(var n=0;n<t.interactableObjects.length;n++){if(t._util.fullyInside(i,t.interactableObjects[n])){e(t.interactableObjects[n]);break}}},fullyInside:function(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}};function o(t,i){"use strict";this.ctx=new s(t.getContext("2d")),this.ctx.canvas=t,(i=i||{}).images=i.images||{},this.width=i.width||t.offsetWidth,this.height=i.height||t.offsetHeight,this.center={x:this.width/2,y:this.height/2},this.images=i.images,this.AlignToCenter=i.AlignToCenter||!1,this.container=t;var e={},n=i.spriteMaps||i.spriteFonts;n&&n.forEach(function(t){e[t.meta.image]=t.frames}),this.spriteMaps=e,this.objects=[],this.interactableObjects=[],this.firstFrame=!0,this.customShapes={},this._util=r,this.update=this.__update.bind(this)}return o.prototype={translateScaleRotate(t){"dummyParent"!=t.parent.id&&this.translateScaleRotate(t.parent),"circle"==t.type&&(t.width=t.height=t.radius/2),t.width=t.width||0,t.height=t.height||0;var i=t.transformOrigin.replace(/%/g,"").split(" ");t.centerX=t.width*(Number(i[0])/100),t.centerY=t.height*(Number(i[1])/100);var e=new h;"dummyParent"==t.parent.id&&this.AlignToCenter&&e.translate(this.center.x,this.center.y),e.translate(t.x,t.y),e.translate(t.centerX,t.centerY),e.skew(t.skewX,t.skewY),e.rotate(t.rotation*Math.PI/180),e.scale(t.scaleX,t.scaleY),e.translate(-t.centerX,-t.centerY),this.ctx.transform(e.data[0],e.data[1],e.data[2],e.data[3],e.data[4],e.data[5])},importImages:function(t){for(k in t)r.loadImageFromUrl(this.images,k,t[k])},prepareShape:function(t){return r.setObjectScale(t),this.prepFuncs[t.type]&&this.prepFuncs[t.type].bind(this)(t),this.ctx.save(),this.ctx.set("globalCompositeOperation",t.globalCompositeOperation),this.translateScaleRotate(t),this},fillAndStroke:function(t){return t.null||this.ctx.fillAndStroke(t.style,t.opacity),this},styleShape:function(t){this.ctx.setAll(t)},draw:function(t){this.prepareShape(t),this.styleShape(t.style),this.renderFuncs[t.type](this,t),this.debugObject(t),this.ctx.restore()},debugObject:function(t){t.debug&&(r.shapes.circle(this,t.centerX,t.centerY,10),el.ctx.set("globalCompositeOperation","difference"),this.ctx.fill())},initFuncs:{text:function(t){"safari"==t.style.textBaseline&&delete t.style.textBaseline},image:function(t){t.id=t.id||t.url,this.images[t.id]||(t.url?r.loadImageFromUrl(this.images,t.id,t.url):t.radialGradient&&(this.images[t.id]=r.generateRadialGradientBitmap(t.id,t.radialGradient.size,t.radialGradient.inner,t.radialGradient.outer)))},textSprite:function(t){t.width=t.width||this.container.width,t.height=t.height||this.container.height,t.type="rect",t.map=t.map||t.font,t.width/=t.scale,t.height/=t.scale;var i=t.map&&this.spriteMaps[t.map];if(i){var e=0,n=0,a=t.width,s=t.missing||r.missingLetterProps(i),h=this,o=t.text.split("").map(function(r){if("\n"==r)return c(),null;var o,l=i[r]&&i[r].frame;if(l)o={type:"image",id:t.map,width:l.w,height:l.h,sprite:{width:l.w,height:l.h,x:l.x,y:l.y}};else{if(t.skipMissing)return null;o=Object.assign({},s)}return e+o.width>a&&c(),o.x=e,o.y=n,o.zIndex=1,o.parent=t,e+=o.width+t.letterSpacing,h.addObject(o)}).filter(function(t){return!!t});r.adjustAlignment(o,a,t.align),t.letters=o}function c(){e=0,n+=s.height*t.lineHeight}}},prepFuncs:{line:function(t){t.x=t.x1,t.y=t.y1},quadLine:function(t){t.x=t.x1,t.y=t.y1},image:function(t){var i=this.images[t.id]||n();i instanceof Image?(t.width=t.width||i.width,t.height=t.height||i.height,t.sprite&&(t.width=t.sprite.width,t.height=t.sprite.height)):console.log("This image is not ready or not an image",i)}},renderFuncs:{rect:function(t,i){return i.radius?r.shapes.roundRect(t,0,0,i.width,i.height,i.radius):r.shapes.normalRect(t,0,0,i.width,i.height),t.fillAndStroke(i)},circle:function(t,i){return r.shapes.circle(t,0,0,i.radius),t.fillAndStroke(i)},line:function(t,i){return t.ctx.beginPath().moveTo(0,0).lineTo(i.x2-i.x1,i.y2-i.y1),t.fillAndStroke(i)},quadLine:function(t,i){return t.ctx.beginPath().moveTo(0,0).quadraticCurveTo(i.qx,i.qy,i.x2-i.x1,i.y2-i.y1),t.fillAndStroke(i)},image:function(t,i){var e=t.images[i.id]||n();e instanceof Image&&(t.ctx.fillAndStroke("empty",i.opacity),i.sprite?t.ctx.drawImage(e,i.sprite.x,i.sprite.y,i.sprite.width,i.sprite.height,0,0,i.width,i.height):(i.rounded&&(r.shapes.roundRect(t,0,0,i.width,i.height,i.rounded),t.ctx.clip()),t.ctx.drawImage(e,0,0,i.width,i.height)),t.ctx.fillAndStroke(i.style,"empty"))},text:function(t,i){t.ctx.fillAndStroke("empty",i.opacity);var e=void 0;if(i.maxWidth){e=i.maxWidth;var n=t.ctx.measureText(i.text).width;if(i.maxWidth<n){var a=i.maxWidth/n;t.ctx.scale(1,a)}}i.style.strokeStyle&&t.ctx.strokeText(i.text,0,0,e),t.ctx.fillText(i.text,0,0,e)},shape:function(t,i){("function"==typeof i.customShape?i.customShape:t.customShapes[i.customShape])(t),t.fillAndStroke(i,i.opacity)},svg:function(t,i){i.__cachedPoints!==i.points&&(i.__cachedFunction=r.parseSvgPathData(i,t.ctx),i.__cachedPoints=i.points),i.__cachedFunction(),t.fillAndStroke(i,i.opacity)}},addObject:function(t,i){return i=i||t&&t.type,t=r.mergeDefaultProperties(t,i),this.initFuncs[t.type]&&this.initFuncs[t.type].bind(this)(t),this.objects.push(t),this.objectsCount=this.objects.length,(t.interactable||t.debug)&&this.interactableObjects.push(t),t},__update:function(){this.firstFrame&&(r.addParents(this.objects),this.sortByZIndex()),this.ctx.clearRect(0,0,9999,9999);for(var t=0;t<this.objectsCount;t++)this.draw(this.objects[t]);this.firstFrame=!1},sortByZIndex:function(){this.objects.sort(function(t,i){return t.zIndex-i.zIndex})},remove:function(t){var i=this.objects.indexOf(t);if(t instanceof Array)for(var e=0;e<t.length;e++)this.remove(t[e]);else if(i>-1){if(t.childNodes)for(e=0;e<t.childNodes.length;e++){var n=t.childNodes[e],a=this.objects.indexOf(n);this.objects.splice(a,1),this.objectsCount--}this.objects.splice(i,1),this.objectsCount--}},addEventListener:function(t,i){var e=this.container,n=this;e.addEventListener(t,function(t){var a=e.currentStyle||window.getComputedStyle(e,null),s=parseInt(a.borderLeftWidth,10),h=parseInt(a.borderTopWidth,10),r=e.getBoundingClientRect(),o=r.width/n.width,c=r.height/n.height,l=(t.clientX-s-r.left)/o,d=(t.clientY-h-r.top)/c;t.canvasX=l,t.canvasY=d,i(t)})},addResizeListener:function(t){var i=this,e=r.debounce(t);window.addEventListener("resize",function(){i.container.width=i.container.parentNode.offsetWidth,i.container.height=i.container.parentNode.offsetHeight,i.width=i.container.width,i.height=i.container.height,e("debounced")},!1)},ready:function(){return Promise.all(Object.values(this.images).filter(function(t){return t instanceof Promise}))}},["rect","circle","line","quadLine","image","shape","text","svg","textSprite"].forEach(function(t){o.prototype[t]=function(i){return this.addObject(i,t)}}),o}();
